# Users Folder

> **Available languages**: [English (current)](README.md) | [Italiano](README.it.md)

The **`users`** folder contains user configurations that can be included in a chosen host’s `configuration.nix` file.  For **each user**, create a subfolder named after the user. Inside it, include:

- **`<USERNAME>.nix`** – The user configuration file  
- **`dotfiles`** (optional) – A folder containing any dotfiles to be copied to the user’s `~/.config/`

## Folder Structure

```bash
users/
└── XYZ/
    ├── dotfiles/
    └── user.nix
```

The **`XYZ`** folder is a sample. Copy it, rename it according to the new user’s name, and adjust the configurations to your needs.

---

## `user.nix` File

This file defines a **basic Linux user** with:

- A **password hash** generated by running `mkpasswd -m sha-512`  
- A main group matching the username  
- A user ID (UID) and group ID (GID) set to **1000**  
- A home directory at `"/home/<USERNAME>"`, which will contain subfolders like `Documents`, `Download`, `Images`, and `Videos`  
- Membership in the **`wheel`** group for administrator privileges  
- A few **shell aliases** configured
- **Security restrictions** specifying which commands can be executed with **`sudo`**

> **WARNING**: if you plan to create multiple users, **each user’s UID and GID must be unique**.  
> Make sure to change the default UID/GID values to avoid conflicts.

Additionally:

- **Common desktop software** can be installed automatically (each package has an explanatory comment).  
- **Dotfiles** can be copied into `~/.config` of the user (read the [dotfiles folder](#dotfiles-folder) below).
- If you use **Syncthing**, two lines can be uncommented to run Syncthing as this user (with the same UID and GID).  
- If you install **Virtual Machine Manager**, you can add the user to its group for managing virtual machines.

For **home folder creation**, we use **tmpfiles** (a systemd component) to create persistent directories. Though tmpfiles is often used for temporary files and folders, you can specify a “persistent” mode by setting the `age` argument to “-”.

For more information on **tmpfiles**, see:  
- [https://www.freedesktop.org/software/systemd/man/latest/tmpfiles.d.html](https://www.freedesktop.org/software/systemd/man/latest/tmpfiles-setup.service.html](https://www.freedesktop.org/software/systemd/man/latest/systemd-tmpfiles-setup.service.html)

> **Note**: in `user.nix`, make sure to change the variables:
> - `${USER}` to the actual username  
> - `${DICTIONARY}` with the chosen dictionary (e.g., `en-US`)  
> - `${BASEPATHUSER}` to the absolute path of the **parent folder** of `nixos_configs`

---

## `dotfiles` Folder

The **`dotfiles`** folder is **optional** and is used to copy your personal dotfiles into the user’s `~/.config` directory during the build.  
This copying is also handled via **tmpfiles**.  

- By default, we use the **“C+”** type, which recursively copies files or directories only if the destination does not already exist or is empty. If you later modify dotfiles in the home folder (instead of in `nixos_configs`), they may be overwritten on rebuild.  

To avoid overwriting local changes, you can either:  
1. **Also update the dotfiles** in the `nixos_configs` source folder, or  
2. **Change the tmpfiles action** from `“C+”` to `“L”` to create a symlink from `nixos_configs/users/<USER>/dotfiles/` into `/home/<USER>/.config`, or  
3. **Use a tool like GNU Stow** to manage dotfiles.
